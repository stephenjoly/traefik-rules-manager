http:
  routers:
    n8n-rtr:
      rule: 'Host(`n8n.{{ env "DOMAINNAME_1" }}`)'
      entryPoints:
        - websecure
      middlewares:
        - n8n-headers  # Add this middleware
      service: n8n-svc
      tls:
        certResolver: dns-cloudflare
        options: tls-opts@file

  middlewares:
    n8n-headers:
      headers:
        customRequestHeaders:
          X-Forwarded-Proto: "https"
          X-Forwarded-For: ""
        customResponseHeaders:
          X-Frame-Options: "SAMEORIGIN"

  services:
    n8n-svc:
      loadBalancer:
        passHostHeader: true
        servers:
          - url: 'http://{{ env "SERVERIP_PRODUCTION" }}:5678'
