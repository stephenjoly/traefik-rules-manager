http:
  routers:
    obsidian-livesync:
      rule: 'Host(`obsidian-livesync.{{ env "DOMAINNAME_1" }}`)'
      entryPoints:
        - websecure
      service: obsidian-livesync
      middlewares:
        - obsidiancors
      tls:
        certResolver: letsencrypt

  services:
    obsidian-livesync:
      loadBalancer:
        servers:
          - url: 'http://{{ env "SERVERIP_DEVELOPMENT" }}:5984'

  middlewares:
    obsidiancors:
      headers:
        accessControlAllowMethods:
          - GET
          - PUT
          - POST
          - HEAD
          - DELETE
        accessControlAllowHeaders:
          - accept
          - authorization
          - content-type
          - origin
          - referer
        accessControlAllowOriginList:
          - app://obsidian.md
          - capacitor://localhost
          - http://localhost
        accessControlMaxAge: 3600
        addVaryHeader: true
        accessControlAllowCredentials: true


# http:
#   routers:
#     obsidian-livesync-rtr:
#       rule: 'Host(`obsidian-livesync.{{ env "DOMAINNAME_1" }}`)'
#       entryPoints:
#         - websecure
#       middlewares:
#         - chain-no-auth-no-compress
#       service: obsidian-livesync-svc
#       tls:
#         certResolver: dns-cloudflare
#         options: tls-opts@file

#   services:
#     obsidian-livesync-svc:
#       loadBalancer:
#         passHostHeader: true
#         serversTransport: "obsidian-livesync"
#         servers:
#           - url: 'http://{{ env "SERVERIP_DEVELOPMENT" }}:5984'

#   serversTransports:
#     obsidian-livesync:
#       insecureSkipVerify: true